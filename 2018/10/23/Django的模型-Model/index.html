<!DOCTYPE html>
<html lang=>
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="description" content="">
  <meta name="keywords" content="">
  
    <link rel="icon" href="/favicon.ico">
  
    
  <title>Django的模型(Model) | tomxxkl的个人博客</title>
  <link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="/lib/jquery.fancybox.min.css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
  <header>
  <div class="header-container">
    <a class='logo' href="/">
      <span>tomxxkl的个人博客</span>
    </a>
    <ul class="right-header">
      
        <li class="nav-item">
          
            <a href="/" class="item-link">首页</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/about" class="item-link">关于</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/archives" class="item-link">归档</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/tags" class="item-link">标签</a>
          
        </li>
      
    </ul>
  </div>
</header>

  <main id='post'>
  <div class="content">
    <article>
        <section class="content markdown-body">
          <h1>Django的模型(Model)</h1>
          <div class='post-meta'>
            <i class="fa fa-calendar" aria-hidden="true"></i> <time>2018/10/23</time>
            
            
          </div>
          <h3 id="1-模型的创建和说明"><a href="#1-模型的创建和说明" class="headerlink" title="1.模型的创建和说明"></a>1.模型的创建和说明</h3><h4 id="创建项目app"><a href="#创建项目app" class="headerlink" title="创建项目app"></a>创建项目app</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(djenv6) D:\Python_Study\workspace\day02&gt;python manage.py startapp app</span><br></pre></td></tr></table></figure>
<p>orm：object-relational-mapping 对象关系映射</p>
<h4 id="创建model并映射到数据库"><a href="#创建model并映射到数据库" class="headerlink" title="创建model并映射到数据库"></a>创建model并映射到数据库</h4><p>1.在app里的models.py里创建学生类<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">	<span class="comment"># 定义字符串类型max_length设置最大长度</span></span><br><span class="line">	s_name = models.CharField(max_length=<span class="number">6</span>, unique=<span class="keyword">True</span>)</span><br><span class="line">	<span class="comment"># 定义s_age字段, int类型</span></span><br><span class="line">	s_age = models.IntegerField(default=<span class="number">18</span>)</span><br><span class="line">	<span class="comment">#定义性别，默认值是true(男)</span></span><br><span class="line">	s_gender = models.BooleanField(default=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">		<span class="comment">#定义模型迁移到数据库中时的表名</span></span><br><span class="line">		db_table = <span class="string">'student'</span></span><br></pre></td></tr></table></figure></p>
<p>2.修改整个项目的settings.py里的INSTALLED_APPS,添加app<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">INSTALLED_APPS= [</span><br><span class="line">    <span class="string">'django.contrib.admin'</span>,</span><br><span class="line">    <span class="string">'django.contrib.auth'</span>,</span><br><span class="line">    <span class="string">'django.contrib.contenttypes'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages'</span>,</span><br><span class="line">    <span class="string">'django.contrib.staticfiles'</span>,</span><br><span class="line">    <span class="string">'app'</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p>3.迁移数据(两步)<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python manage.py makemigrations 生成迁移文件</span><br><span class="line">python manage.py migrate 执行迁移</span><br></pre></td></tr></table></figure></p>
<p>4.修改模型添加两个字段</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#定义create_time字段，创建时间,自动添加(插入数据的时间)当前时间</span></span><br><span class="line"><span class="comment">#auto_now_add:表示添加数据的时间 null=True表示允许为空(默认是null)</span></span><br><span class="line">create_time = models.DateTimeField(auto_now_add=<span class="keyword">True</span>,null=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#定义operate_time字段，修改时间,修改数据的时间</span></span><br><span class="line"><span class="comment">#auto_now:表示修改数据的时间,null=True默认是null</span></span><br><span class="line">operate_time = models.DateTimeField(auto_now=<span class="keyword">True</span>,null=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure>
<p>5.重新生成迁移文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pyhton manage.py makemigrations</span><br></pre></td></tr></table></figure>
<p>6.更新数据库表结构</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pyhton manage.py mirgrate</span><br></pre></td></tr></table></figure>
<p>7.添加创建学生的url</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 127.0.0.1:8080/create_stu/   创建学生对象</span><br><span class="line">url(r&apos;^create_stu/&apos;, views.create_stu)</span><br></pre></td></tr></table></figure>
<p>8.在app里的views.py里面创建create_stu方法 obj.save()表示向数据库表里添加一条记录</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_stu</span><span class="params">(request)</span>:</span></span><br><span class="line">	<span class="comment"># 第一种方式:创建学生</span></span><br><span class="line">	stu = Student()</span><br><span class="line">	stu.s_name = <span class="string">'张三'</span></span><br><span class="line">	stu.s_age = <span class="number">20</span></span><br><span class="line">	<span class="comment"># 保存到数据库中的表中</span></span><br><span class="line">	stu.save()</span><br><span class="line">	<span class="string">'''</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	# 第二种方式:创建学生</span></span><br><span class="line"><span class="string">	Student.objects.create(s_name='张四')</span></span><br></pre></td></tr></table></figure>
<h3 id="2-Django的orm常用查询方法"><a href="#2-Django的orm常用查询方法" class="headerlink" title="2. Django的orm常用查询方法"></a>2. Django的orm常用查询方法</h3><p>1.all()方法:查询信息<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">格式:</span><br><span class="line">	类.objects.all() #返回值是querySet</span><br><span class="line">students = Student.objects.all()</span><br></pre></td></tr></table></figure></p>
<p>2.filter()方法:过滤查询部分的信息</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">格式:</span><br><span class="line">	类.objects.filter(字段过滤条件) #返回值是querySet</span><br><span class="line">stus = Student.objects.filter(s_name=&apos;张三&apos;)</span><br><span class="line"></span><br><span class="line"># first()获取查询集合的第一个</span><br><span class="line">stu = Student.objects.filter(s_age=20).first() #返回值具体的对象</span><br><span class="line"></span><br><span class="line">#last()获取查询集合的最后一个</span><br><span class="line">stus = Student.objects.filter(s_age=20).last() #返回值是具体的对象</span><br></pre></td></tr></table></figure>
<p>3.get()方法:获取单条记录(具体的对象)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># get只能获取一条记录，超过一条记录以及记录不存在都会报错,不建议使用</span><br><span class="line">stus = Student.objects.get(s_age=20)</span><br></pre></td></tr></table></figure>
<p>4.满足多条条件的查询</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 查询年龄等于二十并且性别是0的信息</span><br><span class="line">stus = Student.objects.filter(s_age=20).filter(s_gender=0)</span><br><span class="line">#这种写法和上面效果一样stus = Student.objects.filetr(s_age=20, s_gender=0)</span><br></pre></td></tr></table></figure>
<p>5.模糊查询</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 模糊查询 like</span><br><span class="line">stus = Student.objects.filter(s_name__contains=&apos;张&apos;)</span><br><span class="line"></span><br><span class="line"># 模糊查询，查询以什么开始的</span><br><span class="line">stus = Student.objects.filter(s_name__startswith=&apos;李&apos;)</span><br><span class="line"></span><br><span class="line"># 模糊查询，查询以什么结束的</span><br><span class="line">stus = Student.objects.filter(s_name__endswith=&apos;四&apos;)</span><br><span class="line"></span><br><span class="line">模糊查询:</span><br><span class="line">	字段__contains=&apos;xx&apos;,查询字段包含xx的记录</span><br><span class="line">	字段__startswith=&apos;xx&apos;,查询字段以xx开始的记录</span><br><span class="line">	字段__endswith=&apos;xx&apos;,查询字段以xx结束的记录</span><br></pre></td></tr></table></figure>
<p>6.大于(gt),小于(lt),大于等于(gte),小于等于(lte)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 大于(gt)小于(lt),大于等于(gte),小于等于(lte)</span><br><span class="line">stus = Student.objects.filter(s_age__gt=18) #年龄大于18的记录</span><br><span class="line"># stus = Student.objects.filter(s_age__lt=21)  # 龄小于18</span><br><span class="line">格式:</span><br><span class="line">	字段__gt=值</span><br><span class="line">	字段__lt=值</span><br><span class="line">	字段__gte=值</span><br><span class="line">	字段__lte=值</span><br></pre></td></tr></table></figure>
<p>7.排序order_by(‘字段’)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#排序 order_by()</span></span><br><span class="line">	<span class="comment"># 升序</span></span><br><span class="line">	stus = Student.objects.order_by(<span class="string">'id'</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 降序</span></span><br><span class="line">	stus = Student.objects.order_by(<span class="string">'-id'</span>)</span><br></pre></td></tr></table></figure>
<p>8.查询不满足条件的记录exclude(字段=值)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查询不满足条件的数据exclude()</span></span><br><span class="line">stus = Student.objects.exclude(s_age=<span class="number">18</span>) <span class="comment">#查询年纪不等于18的</span></span><br></pre></td></tr></table></figure>
<p>9.统计查询个数count()</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 统计查询个数count()和len()等效</span><br><span class="line">stus_count = stus.count()</span><br><span class="line">print(stus_count)</span><br></pre></td></tr></table></figure>
<p>10.获取每条记录的每个字段values()返回值是字典</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 获取每条记录的每个字段values(&apos;字段1&apos;,&apos;字段2&apos;,...)返回值是字典，</span><br><span class="line"># 如果没有指定字段的话那么就会获取全部字段(字典)</span><br><span class="line"></span><br><span class="line">stu_dic = stus.values()</span><br><span class="line">print(stu_dic)</span><br></pre></td></tr></table></figure>
<p>11.查询主键等于特定的值</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查询id等于某个值,pk表示主键，也是id</span></span><br><span class="line">stus = Student.objects.filter(pk=<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<p>12.或(|),且(&amp;),非(~)条件查询 Q()</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line"><span class="comment">#或查询 |</span></span><br><span class="line">stus = Student.objects.filter(Q(s_age=<span class="number">20</span>) | Q(s_gender=<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#且条件查询 &amp;</span></span><br><span class="line">stus = Student.objects.filter(Q(s_age=<span class="number">20</span>) &amp; Q(s_gender=<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#非条件查询 ~</span></span><br><span class="line">stus = Student.objects.filter(~Q(s_age=<span class="number">20</span>))</span><br></pre></td></tr></table></figure>
<p>13.大于等于和小于等于F()</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#查询语文成绩比数学成绩大</span></span><br><span class="line">stus = Student.objects.filter(chinese__gt=F(<span class="string">'math'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#查询语文成绩比数学成绩大10分</span></span><br><span class="line">stus = Student.objects.filter(chinese__gt=F(<span class="string">'math'</span>)+<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#查询语文成绩比数学成绩小10分</span></span><br><span class="line">stus = Student.objects.filter(chinese__lt=F(<span class="string">'math'</span>)<span class="number">-10</span>)</span><br></pre></td></tr></table></figure>
<h3 id="3-Django的orm框架删除和修改"><a href="#3-Django的orm框架删除和修改" class="headerlink" title="3.Django的orm框架删除和修改"></a>3.Django的orm框架删除和修改</h3><p>1.删除</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">del_stu</span><span class="params">(request)</span>:</span></span><br><span class="line">	Student.objects.filter(s_name=<span class="string">'张三'</span>).delete()</span><br><span class="line">	<span class="keyword">return</span> HttpResponse(<span class="string">'删除成功'</span>)</span><br></pre></td></tr></table></figure>
<p>2.修改(更新数据)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update_stu</span><span class="params">(request)</span>:</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">#修改 第一种</span></span><br><span class="line">	 stu = Student.objects.filter(s_name=<span class="string">'李四'</span>).first()</span><br><span class="line">	 stu.s_name = <span class="string">'李思'</span></span><br><span class="line">	 stu.save()</span><br><span class="line"></span><br><span class="line">	<span class="comment">#修改 第二种</span></span><br><span class="line">	 Student.objects.filter(s_name=<span class="string">'李思'</span>).update(<span class="string">'栗子'</span>)</span><br><span class="line">	 <span class="keyword">return</span> HttpResponse(<span class="string">'修改成功'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="4-Django中的Model-模型之间的关系-MVT中的M"><a href="#4-Django中的Model-模型之间的关系-MVT中的M" class="headerlink" title="4.Django中的Model(模型之间的关系)(MVT中的M)"></a>4.Django中的Model(模型之间的关系)(MVT中的M)</h3><p>用例子说明这个Model的作用，Model中的每一个类其实就是数据库对应的每一张表，通过面向对象的思想，操作对象就可以操作数据库表中的对应的数据，数据库表中的每一条记录在查询之后会转换成相应的Model中的类的对象，这儿用学生，课程，班级和学生补充信息的例子来说明</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Grade</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">	g_name = models.CharField(max_length=<span class="number">10</span>,unique=<span class="keyword">True</span>)</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">		db_table = <span class="string">'grade'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">	<span class="comment"># 定义字符串类型max_length设置最大长度</span></span><br><span class="line">	s_name = models.CharField(max_length=<span class="number">6</span>, unique=<span class="keyword">True</span>)</span><br><span class="line">	<span class="comment"># 定义s_age字段, int类型</span></span><br><span class="line">	s_age = models.IntegerField(default=<span class="number">18</span>)</span><br><span class="line">	<span class="comment">#定义性别，默认值是true(男)</span></span><br><span class="line">	s_gender = models.BooleanField(default=<span class="keyword">True</span>)</span><br><span class="line">	<span class="comment">#定义create_time字段，创建时间,自动添加(插入数据的时间)当前时间</span></span><br><span class="line">	<span class="comment">#auto_now_add:表示添加数据的时间</span></span><br><span class="line">	create_time = models.DateTimeField(auto_now_add=<span class="keyword">True</span>,null=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">#定义operate_time字段，修改时间,修改数据的时间</span></span><br><span class="line">	<span class="comment">#auto_now:表示修改数据的时间,null=True默认是True</span></span><br><span class="line">	operate_time = models.DateTimeField(auto_now=<span class="keyword">True</span>,null=<span class="keyword">True</span>)</span><br><span class="line">	<span class="comment">#定义语文</span></span><br><span class="line">	chinese = models.DecimalField(decimal_places=<span class="number">1</span>,max_digits=<span class="number">4</span>,null=<span class="keyword">True</span>)</span><br><span class="line">	<span class="comment">#定义数学</span></span><br><span class="line">	math = models.DecimalField(decimal_places=<span class="number">1</span>,max_digits=<span class="number">4</span>,null=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">#添加学生的外键(班级)</span></span><br><span class="line">	grade = models.ForeignKey(Grade,null=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">		<span class="comment">#定义模型迁移到数据库中时的表名</span></span><br><span class="line">		db_table = <span class="string">'student'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentInfo</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">	phone = models.CharField(max_length=<span class="number">11</span>, null=<span class="keyword">True</span>)</span><br><span class="line">	address = models.CharField(max_length=<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">#OneToOneField指定一对一关联关系</span></span><br><span class="line">	<span class="comment">#stu在数据库中是stu_id,放的是数据库中学生表的id</span></span><br><span class="line">	stu = models.OneToOneField(Student)</span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">		db_table = <span class="string">'student_info'</span></span><br></pre></td></tr></table></figure>
<h4 id="4-1一对一关系"><a href="#4-1一对一关系" class="headerlink" title="4.1一对一关系"></a>4.1一对一关系</h4><p>一对一关系其实就是一张表的补充表，之所以不把这个补充表里的字段，放到一张表里，是为了给最开始那张表添加扩展性，之后的如果要对原始表添加或者修改字段，就不用修改原始表，给补充表添加字段就可以了。</p>
<p>一对一关系，在Django中用models.OneToOneField(&lt;关联的类&gt;),一对一的说明再在两张表中都可以声明，但是一般声明再补充表中:</p>
<p>通过学生表获取学生信息补充表:<br>格式:<br>    原始表对象.补充表类小写</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sel_info_by_stu</span><span class="params">(request)</span>:</span></span><br><span class="line">	<span class="comment">#方式一</span></span><br><span class="line">	<span class="comment">#先获取stu对象</span></span><br><span class="line">    stu = Student.objects.filter(s_name=<span class="string">'张三'</span>).first()</span><br><span class="line">    info = stu.studentinfo</span><br><span class="line">   </span><br><span class="line">    <span class="comment"># 方式二</span></span><br><span class="line">    info = StudentInfo.objects.filter(stu_id=stu.id)</span><br><span class="line">    <span class="comment"># 面向对象的方式</span></span><br><span class="line">    info = StudentInfo.objects.filter(stu=stu)</span><br></pre></td></tr></table></figure>
<p>通过学生信息补充表获取学生:</p>
<p>格式:</p>
<p>​    学生信息补充对象.关联字段</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sel_stu_by_info</span><span class="params">(request)</span>:</span></span><br><span class="line">    info = StudentInfo.objects.get(phone=<span class="string">'110'</span>)</span><br><span class="line">    stu = info.stu</span><br></pre></td></tr></table></figure>
<h4 id="4-2-一对多关系"><a href="#4-2-一对多关系" class="headerlink" title="4.2 一对多关系"></a>4.2 一对多关系</h4><p>一对多的关系主要是要在多的那一边加上一个那边的外键，就比如说一个班级会有多个学生，在django设计model是需要在多的表使用ForeignKeyField(&lt;一的表的对象&gt;,null=True)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">grade = models.ForeignKey(Grade,null=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure>
<p>通过多的一方获取一的一方的格式:</p>
<p>​    多的一方的对象.字段</p>
<p>通过一个一方获取多的一方的格式:</p>
<p>​    一的对象,多的类(xiaoxie)_set()   – 这种方式获取的是关系，如果还要获取具体的对象，需要对这个关系进行filter()或者all()</p>
<p>通过学生(多)获取班级(一):</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sel_stu_grade</span><span class="params">(request)</span>:</span></span><br><span class="line">	<span class="keyword">if</span> request.method == <span class="string">'GET'</span>:</span><br><span class="line">		<span class="comment"># 通过学生查找班级</span></span><br><span class="line">		stu = Student.objects.filter(s_name=<span class="string">'张三'</span>).first()</span><br><span class="line">		grade = stu.grade</span><br></pre></td></tr></table></figure>
<p>通过班级(一)获取学生(多):</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sel_garde_stu</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># 通过班级查找学生   一的对象.多的模型小写__set() 获取班级的学生关系</span></span><br><span class="line">	<span class="comment"># 查询出来的关系可以通过filter等方法经过筛选</span></span><br><span class="line">	grade = Grade.objects.filter(g_name=<span class="string">'软件工程2班'</span>).first()</span><br><span class="line">	stus = grade.student_set.all()</span><br><span class="line">	<span class="keyword">for</span> stu <span class="keyword">in</span> stus:</span><br><span class="line">		print(stu.s_name)</span><br></pre></td></tr></table></figure>
<h4 id="4-3-多对多关系"><a href="#4-3-多对多关系" class="headerlink" title="4.3 多对多关系"></a>4.3 多对多关系</h4><h3 id="5-Django中的view-MVT中的V"><a href="#5-Django中的view-MVT中的V" class="headerlink" title="5.Django中的view(MVT中的V)"></a>5.Django中的view(MVT中的V)</h3><p>Django中view是存在于每个应用程序的，而不是一个项目只有一个view,它位于应用程序目录下的views.py里，通过在这里创建方法，然后在项目的setting.py里面配置应用程序，以及在urls.py配置执行路径，就可以通过views.py里的方法操作Model，在把操作的结果返回template里的指定的html文件进行显示。</p>
<p>显示学生信息的例子:</p>
<p>views.py部分:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">all_stu</span><span class="params">(request)</span>:</span></span><br><span class="line">	<span class="comment">#获取所有学生信息</span></span><br><span class="line">	stus = Student.objects.all()</span><br><span class="line">	<span class="comment">#返回页面</span></span><br><span class="line">	<span class="keyword">return</span> render(request, <span class="string">'stus.html'</span>, &#123;<span class="string">'students'</span>:stus&#125;)</span><br></pre></td></tr></table></figure>
<p>setting.py部分:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">'django.contrib.admin'</span>,</span><br><span class="line">    <span class="string">'django.contrib.auth'</span>,</span><br><span class="line">    <span class="string">'django.contrib.contenttypes'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages'</span>,</span><br><span class="line">    <span class="string">'django.contrib.staticfiles'</span>,</span><br><span class="line">    <span class="string">'app'</span>, <span class="comment">#这个是该应用程序的名字</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">TEMPLATES = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">'BACKEND'</span>: <span class="string">'django.template.backends.django.DjangoTemplates'</span>,</span><br><span class="line">        <span class="comment">#配置项目模板路径</span></span><br><span class="line">		<span class="comment">#D:\\python学习\python第二阶段\项目名\templates</span></span><br><span class="line">        <span class="string">'DIRS'</span>: [os.path.join(BASE_DIR, <span class="string">'templates'</span>)],</span><br><span class="line">        <span class="string">'APP_DIRS'</span>: <span class="keyword">True</span>,</span><br><span class="line">        <span class="string">'OPTIONS'</span>: &#123;</span><br><span class="line">            <span class="string">'context_processors'</span>: [</span><br><span class="line">                <span class="string">'django.template.context_processors.debug'</span>,</span><br><span class="line">                <span class="string">'django.template.context_processors.request'</span>,</span><br><span class="line">                <span class="string">'django.contrib.auth.context_processors.auth'</span>,</span><br><span class="line">                <span class="string">'django.contrib.messages.context_processors.messages'</span>,</span><br><span class="line">            ],</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>urls.py部分<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">	url(<span class="string">r'^all_stu/'</span>, views.all_stu),</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<h3 id="6-Django的templates-MVT中的T"><a href="#6-Django的templates-MVT中的T" class="headerlink" title="6. Django的templates(MVT中的T)"></a>6. Django的templates(MVT中的T)</h3><p>templates是和应用程序同级的文件夹，里面存放的是html模板，用来显示通过view拿到model中的数据，templates里的获取从views传来的数据通过</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;% 数据%&#125;和&#123;&#123;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>例子:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>学生信息<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>学生信息<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">style</span>=<span class="string">"border: 1px solid black"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>年龄<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>性别<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        &#123;% for stu in students %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; stu.s_name &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; stu.s_age &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            &#123;% if stu.s_gender %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                男</span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            &#123;% else %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                女</span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            &#123;% endif %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/add_info/?stu_id=&#123;&#123; stu.id &#125;&#125;"</span>&gt;</span>添加扩展信息<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/add_rel_grade/?stu_id=&#123;&#123; stu.id &#125;&#125;"</span>&gt;</span>添加所属班级<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

        </section>
    </article>
    
        <!-- disqus 评论框 start -->
        <div class="comment">
            <div id="disqus_thread" class="disqus-thread">
              <i>Loading comments box needs to over the wall</i>
            </div>
        </div>
        <!-- disqus 评论框 end -->
    
    
        <!-- livere 评论框 start -->
        <div class="comment">
            <div id="lv-container" data-id="city" data-uid="your_livere_uid"></div>
        </div>
        <!-- livere 评论框 end -->
        
  </div>
  <aside>
    
    <div class="toc-container">
        <h1>目录</h1>
        <div class="content">
            <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-模型的创建和说明"><span class="toc-number">1.</span> <span class="toc-text">1.模型的创建和说明</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建项目app"><span class="toc-number">1.1.</span> <span class="toc-text">创建项目app</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建model并映射到数据库"><span class="toc-number">1.2.</span> <span class="toc-text">创建model并映射到数据库</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Django的orm常用查询方法"><span class="toc-number">2.</span> <span class="toc-text">2. Django的orm常用查询方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Django的orm框架删除和修改"><span class="toc-number">3.</span> <span class="toc-text">3.Django的orm框架删除和修改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-Django中的Model-模型之间的关系-MVT中的M"><span class="toc-number">4.</span> <span class="toc-text">4.Django中的Model(模型之间的关系)(MVT中的M)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1一对一关系"><span class="toc-number">4.1.</span> <span class="toc-text">4.1一对一关系</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-一对多关系"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 一对多关系</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-多对多关系"><span class="toc-number">4.3.</span> <span class="toc-text">4.3 多对多关系</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-Django中的view-MVT中的V"><span class="toc-number">5.</span> <span class="toc-text">5.Django中的view(MVT中的V)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-Django的templates-MVT中的T"><span class="toc-number">6.</span> <span class="toc-text">6. Django的templates(MVT中的T)</span></a></li></ol>
        </div>
    </div>
    
  </aside>
</main>

<!-- disqus 公共JS代码 -->
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES * * */
  var disqus_shortname = "your_disqus_shortname";
  var disqus_identifier = "http://yoursite.com/2018/10/23/Django的模型-Model/";
  var disqus_url = "http://yoursite.com/2018/10/23/Django的模型-Model/";

  isAgent(getDisqus)

  // determine user agent in China
  function isAgent(cb) {
    var url = '//graph.facebook.com/feed?callback=h';
    var xhr = new XMLHttpRequest();
    var called = false;
    xhr.open('GET', url);
    xhr.onreadystatechange = function() {
      if (xhr.readyState === 4 && xhr.status === 200) {
      called = true;
      cb(true);
      }
    };
    xhr.send();
    // timeout 1s, this facebook API is very fast.
    setTimeout(function() {
      if (!called) {
      xhr.abort();
      cb(false)
      }
    }, 1000);
  }

  function getDisqus(isAgent) {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; 
    dsq.async = true
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq)
  }
</script>
<!-- disqus 公共JS代码 end -->


<script type="text/javascript">
  (function(d, s) {
      var j, e = d.getElementsByTagName(s)[0];

      if (typeof LivereTower === 'function') { return; }

      j = d.createElement(s);
      j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
      j.async = true;

      e.parentNode.insertBefore(j, e);
  })(document, 'script');
</script>


  <footer>
  <div class="copyright">
    <div>
      &copy; 2018 | Powered by <a href="https://hexo.io" target="_blank">Hexo</a>&nbsp
    </div>
    <div>
      Theme by <a href="https://github.com/lewis-geek/hexo-theme-Aath" target="_blank">Aath</a>
    </div>
  </div>
</footer>


<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script src="/lib/in-view.min.js"></script>
<script src="/lib/lodash.min.js"></script>
<script>
  var isDown = true
  var oldY = 0
  inView.offset(50)

  document.body.addEventListener('touchstart', function(){});
  
  window.addEventListener('scroll', _.throttle(e => {
    var currentY = window.scrollY
    if((oldY - currentY) < 0) {
      isDown = true
    } else {
      isDown = false
    }
    oldY = currentY
  }, 250))

  $("article img").each(function() {
      var strA = "<a data-fancybox='gallery' href='" + this.src + "'></a>";
      $(this).wrapAll(strA);
  });

  $('.toc-link').each(function() {
      var href = $(this).attr("href");
      
      inView(href).on('exit', () => {
        if (isDown) {
          handleActive(href)
        }
      })

      inView(href).on('enter', () => {
        if (!isDown) {
          handleActive(href)
        }
      })

      this.onclick = function(e) {
        var pos = $(href).offset().top - 10;
        $("html,body").animate({scrollTop: pos}, 300);
        setTimeout(() => {
          handleActive(href)
        }, 350)
        return false
      }
  })

  function handleActive(href) {
    document.querySelectorAll('.toc-link').forEach(elm => {
      elm.classList.remove('active')
    })
    document.querySelector(".toc [href='"+ href +"']").classList.add('active')
  }
</script>
<script src="/lib/jquery.fancybox.min.js"></script>


</body>
</html>
